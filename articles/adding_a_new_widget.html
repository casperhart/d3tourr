<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="description" content="detourr">
<title>Adding a New Display Method and Widget to {detourr} • detourr</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.1.0/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.1.0/bootstrap.bundle.min.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- bootstrap-toc --><script src="https://cdn.rawgit.com/afeld/bootstrap-toc/v1.0.1/dist/bootstrap-toc.min.js"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- search --><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Adding a New Display Method and Widget to {detourr}">
<meta property="og:description" content="detourr">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>
    

    <nav class="navbar fixed-top navbar-light navbar-expand-lg bg-light"><div class="container">
    
    <a class="navbar-brand me-2" href="../index.html">detourr</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.0.9</small>

    
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item">
  <a class="nav-link" href="../reference/index.html">Reference</a>
</li>
<li class="active nav-item dropdown">
  <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown" role="button" aria-expanded="false" aria-haspopup="true" id="dropdown-articles">Articles</a>
  <div class="dropdown-menu" aria-labelledby="dropdown-articles">
    <a class="dropdown-item" href="../articles/adding_a_new_widget.html">Adding a New Display Method and Widget to {detourr}</a>
  </div>
</li>
      </ul>
<form class="form-inline my-2 my-lg-0" role="search">
        <input type="search" class="form-control me-sm-2" aria-label="Toggle navigation" name="search-input" data-search-index="../search.json" id="search-input" placeholder="Search for" autocomplete="off">
</form>

      <ul class="navbar-nav"></ul>
</div>

    
  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main"><div class="page-header">
      <img src="" class="logo" alt=""><h1>Adding a New Display Method and Widget to {detourr}</h1>
            
      
      
      <div class="d-none name"><code>adding_a_new_widget.Rmd</code></div>
    </div>

    
    
<style type="text/css">
.codeblock-label {
    position: relative;
    top: 1em;
    display: inline-block;
    border-top-left-radius: .5rem;
    border-top-right-radius: .5rem;
    font-family: Consolas, Monaco, 'Courier New', monospace;
    font-size: .75rem;
    background-color: #e1e7ef;
    background-color: rgb(224,232,240);
    padding: .25rem .75rem;
    border-top-width: 1px;
    border-left-width: 1px;
    border-right-width: 1px;
    border-color: #ccd6e0;
    border-color: rgb(204,214,224);
    margin-bottom: 0;
}
img {
border: none;
}

code span.va {
  color: #007020
}
</style>
<p>{detourr} is designed to be extensible, allowing for the addition of new widgets and display methods independently of existing ones. This vignette details how you can extend {detourr} with your own data visuals.</p>
<div class="section level2">
<h2 id="prerequisites">Prerequisites<a class="anchor" aria-label="anchor" href="#prerequisites"></a>
</h2>
<p>{detourr} uses TypeScript (TS) code to define widgets, which needs to be bundled as changes are made. To do this, you will need <a href="https://nodejs.org" class="external-link">node.js</a> and <a href="https://yarnpkg.com" class="external-link">yarn</a> installed.</p>
<p>After cloning this repository, install the node.js dependencies with:</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode sh"><code class="sourceCode bash"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="ex">yarn</span> install</span></code></pre></div>
<p>Then bundle the TypeScript code and install {detourr} using:</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode sh"><code class="sourceCode bash"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="ex">yarn</span> run build</span></code></pre></div>
</div>
<div class="section level2">
<h2 id="development-setup">Development Setup<a class="anchor" aria-label="anchor" href="#development-setup"></a>
</h2>
<p>When the command <code>yarn run build</code> is run, the first thing to happen is our TS code is transpiled to Javascript using the TS compiler, and is then bundled and output to <code>inst/htmlwidgets</code> by WebPack. This bundled JS code is then installed with the R package and run each time we make a call to <code>animate_tour</code>.</p>
<p>One of the benefits of using Typescript and Webpack is that when we’re developing the TS code, we can run and debug it independently of R. Just think, if every time we made a change we had to build and install the R package to see if it works, then development would be a very slow process. To see this in action, simply run:</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode sh"><code class="sourceCode bash"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="ex">yarn</span> run start-dev</span></code></pre></div>
<p>This starts a Webpack development server on <code>localhost:9000</code>, and opens a UI in the browser with links to each of the widgets in the <code>detourr</code> package, shown below:</p>
<p><img src="images/dev_server_menu.png" width="100%"></p>
<p>Clicking on any of these links will show the development widget in action, for example, clicking on <code>display_scatter_3d</code> gives the below:</p>
<p><img src="images/dev_server_display_scatter_3d.png" width="100%"></p>
<p>In this section, we’ll create our own basic widget, and make it accessible via <code>yarn run start-dev</code>.</p>
<div class="section level3">
<h3 id="creating-a-new-widget-for-development">Creating a New Widget for Development<a class="anchor" aria-label="anchor" href="#creating-a-new-widget-for-development"></a>
</h3>
<p>To get started, we’ll first create a new file <code>srcts/hello_world/index.ts</code> with the following contents:</p>
<p class="codeblock-label">
srcts/hello_world/index.ts
</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode js"><code class="sourceCode javascript"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="im">export</span> <span class="kw">class</span> HelloWorld {</span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a>  <span class="kw">private</span> <span class="dt">containerElement</span><span class="op">:</span> <span class="bu">HTMLDivElement</span><span class="op">;</span></span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a>  <span class="kw">private</span> <span class="dt">message</span><span class="op">:</span> <span class="bu">HTMLHeadElement</span><span class="op">;</span></span>
<span id="cb4-4"><a href="#cb4-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-5"><a href="#cb4-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">constructor</span>(<span class="dt">el</span><span class="op">:</span> <span class="bu">HTMLDivElement</span><span class="op">,</span> <span class="dt">width</span><span class="op">:</span> number<span class="op">,</span> <span class="dt">height</span><span class="op">:</span> number) {</span>
<span id="cb4-6"><a href="#cb4-6" aria-hidden="true" tabindex="-1"></a>    <span class="kw">var</span> h <span class="op">=</span> <span class="bu">document</span><span class="op">.</span><span class="fu">createElement</span>(<span class="st">"h1"</span>)<span class="op">;</span></span>
<span id="cb4-7"><a href="#cb4-7" aria-hidden="true" tabindex="-1"></a>    <span class="kw">var</span> t <span class="op">=</span> <span class="bu">document</span><span class="op">.</span><span class="fu">createTextNode</span>(<span class="st">"Hello, world!"</span>)<span class="op">;</span></span>
<span id="cb4-8"><a href="#cb4-8" aria-hidden="true" tabindex="-1"></a>    h<span class="op">.</span><span class="fu">appendChild</span>(t)<span class="op">;</span></span>
<span id="cb4-9"><a href="#cb4-9" aria-hidden="true" tabindex="-1"></a>    <span class="kw">this</span><span class="op">.</span><span class="at">message</span> <span class="op">=</span> h<span class="op">;</span></span>
<span id="cb4-10"><a href="#cb4-10" aria-hidden="true" tabindex="-1"></a>    <span class="kw">this</span><span class="op">.</span><span class="fu">resize</span>(width<span class="op">,</span> height)<span class="op">;</span></span>
<span id="cb4-11"><a href="#cb4-11" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb4-12"><a href="#cb4-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-13"><a href="#cb4-13" aria-hidden="true" tabindex="-1"></a>  <span class="kw">public</span> <span class="fu">renderValue</span>(<span class="dt">inputData</span><span class="op">:</span> any) {</span>
<span id="cb4-14"><a href="#cb4-14" aria-hidden="true" tabindex="-1"></a>    <span class="bu">document</span><span class="op">.</span><span class="at">body</span><span class="op">.</span><span class="fu">appendChild</span>(<span class="kw">this</span><span class="op">.</span><span class="at">message</span>)<span class="op">;</span></span>
<span id="cb4-15"><a href="#cb4-15" aria-hidden="true" tabindex="-1"></a>    <span class="bu">console</span><span class="op">.</span><span class="fu">log</span>(inputData)<span class="op">;</span></span>
<span id="cb4-16"><a href="#cb4-16" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb4-17"><a href="#cb4-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-18"><a href="#cb4-18" aria-hidden="true" tabindex="-1"></a>  <span class="kw">public</span> <span class="fu">resize</span>(<span class="dt">width</span><span class="op">:</span> number<span class="op">,</span> <span class="dt">height</span><span class="op">:</span> number) {</span>
<span id="cb4-19"><a href="#cb4-19" aria-hidden="true" tabindex="-1"></a>    <span class="bu">console</span><span class="op">.</span><span class="fu">log</span>(<span class="st">"Width: "</span><span class="op">,</span> width<span class="op">,</span> <span class="st">", Height: "</span><span class="op">,</span> height)<span class="op">;</span></span>
<span id="cb4-20"><a href="#cb4-20" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb4-21"><a href="#cb4-21" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<p>Here, the <code>HelloWorld</code> widget is created as it’s own class with two public methods: <code>renderValue</code> and <code>resize</code>.</p>
<p>Notice the <code>renderValue</code> method takes an argument <code>inputData</code>. For now, this is just a string which we will use as a placeholder, but soon this <code>inputData</code> object will contain all the data passed from R to our widget. This includes any configuration we need, our data set, and the sequence of projection matrices representing the tour path.</p>
<p>Later, we will be creating some bindings for {htmlwidgets}, which will require a <code>renderValue</code> and <code>resize</code> function. Having these contained as methods in our <code>HelloWorld</code> class will make this much easier.</p>
<p>Before we can run the above in the browser, we’ll need to create two more files:</p>
<ul>
<li>
<code>dev/hello_world/sample_data.json</code>: a file containing sample data that our widget will use.</li>
<li>
<code>dev/hello_world/index.html</code> will contain logic to import the class we defined above, load the sample data, and render our widget.</li>
</ul>
<p class="codeblock-label">
dev/hello_world/sample_data.json
</p>
<div class="sourceCode" id="cb5"><pre class="sourceCode js"><code class="sourceCode javascript"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="st">"hello sample data"</span></span></code></pre></div>
<script type="text/javascript">
"hello sample data"
</script><p class="codeblock-label">
dev/hello_world/static/index.html
</p>
<div class="sourceCode" id="cb6"><pre class="sourceCode js"><code class="sourceCode javascript"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="op">&lt;!</span>DOCTYPE html<span class="op">&gt;</span></span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a><span class="op">&lt;</span>html lang<span class="op">=</span><span class="st">"en"</span><span class="op">&gt;</span></span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a>  <span class="op">&lt;</span>head<span class="op">&gt;</span></span>
<span id="cb6-4"><a href="#cb6-4" aria-hidden="true" tabindex="-1"></a>    <span class="op">&lt;</span>title<span class="op">&gt;</span>Hello World<span class="op">&lt;/</span>title<span class="op">&gt;</span></span>
<span id="cb6-5"><a href="#cb6-5" aria-hidden="true" tabindex="-1"></a>    <span class="op">&lt;</span>script src<span class="op">=</span><span class="st">"hello_world.bundle.js"</span><span class="op">&gt;&lt;/</span>script<span class="op">&gt;</span></span>
<span id="cb6-6"><a href="#cb6-6" aria-hidden="true" tabindex="-1"></a>  <span class="op">&lt;/</span>head<span class="op">&gt;</span></span>
<span id="cb6-7"><a href="#cb6-7" aria-hidden="true" tabindex="-1"></a>  <span class="op">&lt;</span>body<span class="op">&gt;</span></span>
<span id="cb6-8"><a href="#cb6-8" aria-hidden="true" tabindex="-1"></a>    <span class="op">&lt;</span>div id<span class="op">=</span><span class="st">"plot"</span><span class="op">&gt;&lt;/</span>div<span class="op">&gt;</span></span>
<span id="cb6-9"><a href="#cb6-9" aria-hidden="true" tabindex="-1"></a>    <span class="op">&lt;</span>script<span class="op">&gt;</span></span>
<span id="cb6-10"><a href="#cb6-10" aria-hidden="true" tabindex="-1"></a>      <span class="fu">fetch</span>(<span class="st">"./sample_data.json"</span>)<span class="op">.</span><span class="fu">then</span>(<span class="kw">function</span> (response) {</span>
<span id="cb6-11"><a href="#cb6-11" aria-hidden="true" tabindex="-1"></a>        <span class="co">// run hello_world using sample data</span></span>
<span id="cb6-12"><a href="#cb6-12" aria-hidden="true" tabindex="-1"></a>        response<span class="op">.</span><span class="fu">json</span>()<span class="op">.</span><span class="fu">then</span>(<span class="kw">function</span> (data) {</span>
<span id="cb6-13"><a href="#cb6-13" aria-hidden="true" tabindex="-1"></a>          <span class="kw">let</span> el <span class="op">=</span> <span class="bu">document</span><span class="op">.</span><span class="fu">getElementById</span>(<span class="st">"plot"</span>)<span class="op">;</span></span>
<span id="cb6-14"><a href="#cb6-14" aria-hidden="true" tabindex="-1"></a>          <span class="kw">let</span> display <span class="op">=</span> <span class="kw">new</span> <span class="bu">window</span>[<span class="st">'hello_world/hello_world'</span>]<span class="op">.</span><span class="fu">HelloWorld</span>(el<span class="op">,</span> <span class="dv">300</span><span class="op">,</span> <span class="dv">300</span>)<span class="op">;</span></span>
<span id="cb6-15"><a href="#cb6-15" aria-hidden="true" tabindex="-1"></a>          display<span class="op">.</span><span class="fu">renderValue</span>(data)<span class="op">;</span></span>
<span id="cb6-16"><a href="#cb6-16" aria-hidden="true" tabindex="-1"></a>          <span class="bu">window</span><span class="op">.</span><span class="fu">addEventListener</span>(<span class="st">"resize"</span><span class="op">,</span> (<span class="bu">event</span>) <span class="kw">=&gt;</span></span>
<span id="cb6-17"><a href="#cb6-17" aria-hidden="true" tabindex="-1"></a>            display<span class="op">.</span><span class="fu">resize</span>(<span class="bu">window</span><span class="op">.</span><span class="at">innerWidth</span> <span class="op">,</span> <span class="bu">window</span><span class="op">.</span><span class="at">innerHeight</span>)</span>
<span id="cb6-18"><a href="#cb6-18" aria-hidden="true" tabindex="-1"></a>          )<span class="op">;</span></span>
<span id="cb6-19"><a href="#cb6-19" aria-hidden="true" tabindex="-1"></a>        })<span class="op">;</span></span>
<span id="cb6-20"><a href="#cb6-20" aria-hidden="true" tabindex="-1"></a>      })<span class="op">;</span></span>
<span id="cb6-21"><a href="#cb6-21" aria-hidden="true" tabindex="-1"></a>    <span class="op">&lt;/</span>script<span class="op">&gt;</span></span>
<span id="cb6-22"><a href="#cb6-22" aria-hidden="true" tabindex="-1"></a>  <span class="op">&lt;/</span>body<span class="op">&gt;</span></span>
<span id="cb6-23"><a href="#cb6-23" aria-hidden="true" tabindex="-1"></a><span class="op">&lt;/</span>html<span class="op">&gt;</span></span></code></pre></div>
<p>With the above files in place, the next thing we need to do is tell Webpack that we want to bundle our <code>hello_world</code> example along with the existing widgets. This bundling is configured via <code>webpack/dev.config.ts</code>, and there are two changes we need to make to this file:</p>
<ol style="list-style-type: decimal">
<li>adding an item under <code>entry</code> to tell webpack where our TS code lives</li>
</ol>
<p class="codeblock-label">
webpack/dev.config.ts
</p>
<div class="sourceCode" id="cb7"><pre class="sourceCode diff"><code class="sourceCode diff"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a>  entry: {</span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a>    "display_scatter_2d/display_scatter_2d":</span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a>      "./srcts/display_scatter_2d/index.ts",</span>
<span id="cb7-4"><a href="#cb7-4" aria-hidden="true" tabindex="-1"></a>    "display_scatter_3d/display_scatter_3d":</span>
<span id="cb7-5"><a href="#cb7-5" aria-hidden="true" tabindex="-1"></a>      "./srcts/display_scatter_3d/index.ts",</span>
<span id="cb7-6"><a href="#cb7-6" aria-hidden="true" tabindex="-1"></a><span class="va">+   "hello_world/hello_world": "./srcts/hello_world/index.ts",</span></span>
<span id="cb7-7"><a href="#cb7-7" aria-hidden="true" tabindex="-1"></a>  },</span></code></pre></div>
<ol start="2" style="list-style-type: decimal">
<li>adding a new pattern under <code>CopyPlugin</code> to tell webpack where to find our <code>index.html</code> and <code>sample_data.json</code> files</li>
</ol>
<p class="codeblock-label">
webpack/dev.config.ts
</p>
<div class="sourceCode" id="cb8"><pre class="sourceCode diff"><code class="sourceCode diff"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a>  plugins: [</span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a>      new CopyPlugin({</span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a>        patterns: [</span>
<span id="cb8-4"><a href="#cb8-4" aria-hidden="true" tabindex="-1"></a>          ...</span>
<span id="cb8-5"><a href="#cb8-5" aria-hidden="true" tabindex="-1"></a><span class="va">+         { from: "dev/hello_world/static/", to: "hello_world" },</span></span>
<span id="cb8-6"><a href="#cb8-6" aria-hidden="true" tabindex="-1"></a>        ],</span>
<span id="cb8-7"><a href="#cb8-7" aria-hidden="true" tabindex="-1"></a>      }),</span>
<span id="cb8-8"><a href="#cb8-8" aria-hidden="true" tabindex="-1"></a>    ],</span></code></pre></div>
<p>Lastly, we need to add a menu item so that we can navigate to our widget when the dev server is started. To do this, we modify <code>dev/index.ts</code> by adding a line to <code>dev/index.html</code> like so:</p>
<p class="codeblock-label">
dev/index.html
</p>
<div class="sourceCode" id="cb9"><pre class="sourceCode diff"><code class="sourceCode diff"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="st">&lt;!DOCTYPE html&gt;</span></span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a><span class="st">&lt;html&gt;</span></span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a><span class="st">&lt;head&gt;</span></span>
<span id="cb9-4"><a href="#cb9-4" aria-hidden="true" tabindex="-1"></a>   &lt;meta http-equiv="Content-Type" content="text/html; charset=utf-8"&gt;</span>
<span id="cb9-5"><a href="#cb9-5" aria-hidden="true" tabindex="-1"></a>   &lt;title&gt;Directory Tree&lt;/title&gt;</span>
<span id="cb9-6"><a href="#cb9-6" aria-hidden="true" tabindex="-1"></a><span class="st">&lt;/head&gt;</span></span>
<span id="cb9-7"><a href="#cb9-7" aria-hidden="true" tabindex="-1"></a><span class="st">&lt;body&gt;</span></span>
<span id="cb9-8"><a href="#cb9-8" aria-hidden="true" tabindex="-1"></a>  &lt;h1&gt;Development Widgets&lt;/h1&gt;&lt;p&gt;</span>
<span id="cb9-9"><a href="#cb9-9" aria-hidden="true" tabindex="-1"></a>  &lt;a href="./display_scatter_2d/"&gt;display_scatter_2d&lt;/a&gt;&lt;br&gt;</span>
<span id="cb9-10"><a href="#cb9-10" aria-hidden="true" tabindex="-1"></a>  &lt;a href="./display_scatter_3d/"&gt;display_scatter_3d&lt;/a&gt;&lt;br&gt;</span>
<span id="cb9-11"><a href="#cb9-11" aria-hidden="true" tabindex="-1"></a><span class="va">+ &lt;a href="./hello_world/"&gt;hello_world&lt;/a&gt;&lt;br&gt;</span></span>
<span id="cb9-12"><a href="#cb9-12" aria-hidden="true" tabindex="-1"></a>  &lt;br&gt;&lt;br&gt;</span>
<span id="cb9-13"><a href="#cb9-13" aria-hidden="true" tabindex="-1"></a><span class="st">&lt;/body&gt;</span></span>
<span id="cb9-14"><a href="#cb9-14" aria-hidden="true" tabindex="-1"></a><span class="st">&lt;/html&gt;</span></span></code></pre></div>
<p>Now, when we start our dev server using <code>yarn run start-dev</code>, we see our new menu option:</p>
<p><img src="images/dev_server_hello_world_menu.png" width="100%"></p>
<p>And we can navigate to our widget!</p>
<p><img src="images/dev_server_hello_world.png" width="100%"></p>
<p>With the above all set up, we can get started developing our widget in Typescript. The development server will watch our TS code for changes, and update immediately when those changes are saved. If our code is invalid, the dev server will tell us exactly where the issue is so that we can fix it. We can modify the contents of our <code>sample_data.json</code> file with the data we expect to receive from R, and then modify the TS code to consume that data.</p>
</div>
</div>
<div class="section level2">
<h2 id="creating-r-and-javascript-bindings">Creating R and Javascript Bindings<a class="anchor" aria-label="anchor" href="#creating-r-and-javascript-bindings"></a>
</h2>
<p>Once we’ve got a widget up and running using the dev server, we will need to integrate it in to the R package with {HTMLWidgets}. The steps in this section are very similar to <a href="https://www.htmlwidgets.org/develop_intro.html" class="external-link">this resource</a>, but there are some additional steps required for us to bundle our widget dependencies.</p>
<div class="section level3">
<h3 id="bundling-our-widget">Bundling our Widget<a class="anchor" aria-label="anchor" href="#bundling-our-widget"></a>
</h3>
<p>The steps to generate a bundle are quite similar to what we did earlier when we modified <code>webpack/dev.config.ts</code>. The only difference here is that we modify the file <code>webpack/package.config.ts</code> instead of the dev config:</p>
<p class="codeblock-label">
webpack/package.config.ts
</p>
<div class="sourceCode" id="cb10"><pre class="sourceCode diff"><code class="sourceCode diff"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a>const path = require("path");</span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a>const webpack = require("webpack");</span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-4"><a href="#cb10-4" aria-hidden="true" tabindex="-1"></a>module.exports = {</span>
<span id="cb10-5"><a href="#cb10-5" aria-hidden="true" tabindex="-1"></a>  mode: "production",</span>
<span id="cb10-6"><a href="#cb10-6" aria-hidden="true" tabindex="-1"></a>  entry: {</span>
<span id="cb10-7"><a href="#cb10-7" aria-hidden="true" tabindex="-1"></a>    "display_scatter_2d": "./srcts/display_scatter_2d/index.ts",</span>
<span id="cb10-8"><a href="#cb10-8" aria-hidden="true" tabindex="-1"></a>    "display_scatter_3d": "./srcts/display_scatter_3d/index.ts",</span>
<span id="cb10-9"><a href="#cb10-9" aria-hidden="true" tabindex="-1"></a><span class="va">+   "hello_world": "./srcts/hello_world/index.ts",</span></span>
<span id="cb10-10"><a href="#cb10-10" aria-hidden="true" tabindex="-1"></a>  },</span></code></pre></div>
<p>This adds our <code>hello_world</code> widget to the list of widgets to be bundled, so when we build and install our package using <code>yarn run build</code>, a file <code>hello_world.bundle.js</code> is created in the <code>inst/htmlwidgets/lib</code> folder along with some other files:</p>
<pre><code>❯ ls -l inst/htmlwidgets/lib
.rw-r--r--  41k chart 30 Jan 13:44 display_scatter_2d.bundle.js
.rw-r--r--  40k chart 30 Jan 13:44 display_scatter_3d.bundle.js
.rw-r--r--  789 chart 30 Jan 13:44 hello_world.bundle.js
.rw-r--r-- 1.2k chart 12 Dec  2021 runtime.bundle.js
.rw-r--r-- 622k chart  7 Jan 14:05 three.bundle.js
.rw-r--r--   92 chart 12 Dec  2021 three.bundle.js.LICENSE.txt</code></pre>
<p>The files that are important for us are <code>runtime.bundle.js</code> and <code>hello_world.bundle.js</code>. The <code>hello_world</code> bundle consists of our code, while <code>runtime.bundle.js</code> contains code for the webpack runtime, which is required for our widget to work. Later on, if our widget uses third party libraries as dependencies, they will be bundled separately and added to this folder, as is the case for <code>three.bundle.js</code>.</p>
</div>
<div class="section level3">
<h3 id="dependencies">Dependencies<a class="anchor" aria-label="anchor" href="#dependencies"></a>
</h3>
<p>So that {HTMLWidgets} knows where to find our bundled code, we need to specify it as a dependency by creating a new file <code>inst/htmlwidgets/hello_world.yaml</code>. For our <code>hello_world</code> example, we’ll create the file with the following contents:</p>
<pre><code>dependencies:
  - name: hello_world 
    src: htmlwidgets/lib/
    version: 0.0.9
    script:
      # these have to be in order of loading
      - runtime.bundle.js # webpack runtime
      - hello_world.bundle.js</code></pre>
<p>More information on this file can be found in <a href="https://www.htmlwidgets.org/develop_intro.html" class="external-link">the htmlwidgets documentation</a></p>
</div>
<div class="section level3">
<h3 id="r-binding-and-display-method">R Binding and Display Method<a class="anchor" aria-label="anchor" href="#r-binding-and-display-method"></a>
</h3>
<p>When make a call to <code>animate_tour</code>, we specify the <code>data</code>, <code>tour_path</code>, and <code>display_method</code> arguments. Technically speaking, the R binding we need (as detailed in <a href="https://www.htmlwidgets.org/develop_intro.html" class="external-link">the htmlwidgets documentation</a>) is already implemented in the in the <code>animate_tour</code> function. To get our widget to show, however, we will need to implement a new display method which provides the necessary context to <code>animate_tour</code> for our widget to be called.</p>
<p class="codeblock-label">
R/display_hello_world.R
</p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co">#' Display Hello World Example</span>
<span class="co">#'</span>
<span class="co">#' Note that these comments will be converted in to documentation by the</span>
<span class="co">#' {roxygen2} package when we run `yarn run build`. As such, the `@export`</span>
<span class="co">#' below is necessary, or else this function won't be made available to the</span>
<span class="co">#' user</span>
<span class="co">#'</span>
<span class="co">#' @export</span>
<span class="va">display_hello_world</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="op">)</span> <span class="op">{</span>
  <span class="va">init</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">data</span>, <span class="va">col_spec</span>, <span class="va">tour_dim</span><span class="op">)</span> <span class="op">{</span>
    <span class="va">data_cols</span> <span class="op">&lt;-</span> <span class="fu">tidyselect</span><span class="fu">::</span><span class="fu"><a href="https://tidyselect.r-lib.org/reference/eval_select.html" class="external-link">eval_select</a></span><span class="op">(</span><span class="va">col_spec</span>, <span class="va">data</span><span class="op">)</span>
    <span class="va">labels</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">data_cols</span><span class="op">)</span>
    <span class="va">widget</span> <span class="op">&lt;-</span> <span class="st">"hello_world"</span>

    <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>
      <span class="st">"plot"</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>
        labels <span class="op">=</span> <span class="va">labels</span>
      <span class="op">)</span>,
      <span class="st">"widget"</span> <span class="op">=</span> <span class="va">widget</span>,
      <span class="st">"mapping"</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="op">)</span>
    <span class="op">)</span>
  <span class="op">}</span>
  <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>
    <span class="st">"init"</span> <span class="op">=</span> <span class="va">init</span>
  <span class="op">)</span>
<span class="op">}</span></code></pre></div>
<p>The return value of <code>display_hello_world</code> is a list containing an <code>init</code> function which is called within <code>animate_tour</code> in order to get a widget-specific configuration. The input to this function consists of:</p>
<ul>
<li>
<code>data</code>: The input data to use as a data frame. This will contain the numeric columns to use for the tour, as well as any additional columns which may be used for aesthetic mappings.</li>
<li>
<code>col_spec</code>: a quosure specifying which numeric columns to use for the tour. Is evaluated using {tidyselect}</li>
<li>
<code>tour_dim</code>: the output dimension of the tour. E.g. 2, 3</li>
</ul>
<p>The <code>init</code> function is expected to return a list with the following elements:</p>
<ul>
<li>
<code>plot</code>: configuation for the plot. Usually a list.</li>
<li>
<code>widget</code>: the name of the htmlwidget to use as a character value. This must be consistent with what is specified in <code>inst/htmlwidgets/hello_world.yaml</code>.</li>
<li>
<code>mapping</code>: aesthetic mappings for the plot, usually in the format <code>list("aesthetic_name": values)</code>
</li>
</ul>
<p>All the values output from this function will be passed through to the <code>hello_world</code> widget’s <code>renderValue</code> method, along with additional fields from the <code>animate_tour</code> function such as the dataset and sequence of projection matrices.</p>
</div>
<div class="section level3">
<h3 id="javascript-binding">Javascript Binding<a class="anchor" aria-label="anchor" href="#javascript-binding"></a>
</h3>
<p>The last piece of the puzzle is the Javascript Binding, which will be a new file located at <code>inst/htmlwidgets/hello_world.js</code>. Because we implemented our widget as a TS class with <code>renderValue</code> and <code>resize</code> methods, the contents of the javascript binding can be quite short, even as the widget itself becomes more complex:</p>
<p class="codeblock-label">
inst/htmlwidgets/hello_world.js
</p>
<div class="sourceCode" id="cb14"><pre class="sourceCode js"><code class="sourceCode javascript"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a>HTMLWidgets<span class="op">.</span><span class="fu">widget</span>({</span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-3"><a href="#cb14-3" aria-hidden="true" tabindex="-1"></a>    <span class="dt">name</span><span class="op">:</span> <span class="st">"hello_world"</span><span class="op">,</span></span>
<span id="cb14-4"><a href="#cb14-4" aria-hidden="true" tabindex="-1"></a>    <span class="dt">type</span><span class="op">:</span> <span class="st">"output"</span><span class="op">,</span></span>
<span id="cb14-5"><a href="#cb14-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-6"><a href="#cb14-6" aria-hidden="true" tabindex="-1"></a>    <span class="dt">factory</span><span class="op">:</span> <span class="kw">function</span> (el<span class="op">,</span> width<span class="op">,</span> height) {</span>
<span id="cb14-7"><a href="#cb14-7" aria-hidden="true" tabindex="-1"></a>        <span class="kw">let</span> widget <span class="op">=</span> <span class="kw">new</span> hello_world<span class="op">.</span><span class="fu">HelloWorld</span>(el<span class="op">,</span> width<span class="op">,</span> height)<span class="op">;</span></span>
<span id="cb14-8"><a href="#cb14-8" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> {</span>
<span id="cb14-9"><a href="#cb14-9" aria-hidden="true" tabindex="-1"></a>            <span class="dt">renderValue</span><span class="op">:</span> <span class="kw">function</span> (x) {</span>
<span id="cb14-10"><a href="#cb14-10" aria-hidden="true" tabindex="-1"></a>                widget<span class="op">.</span><span class="fu">renderValue</span>(x)<span class="op">;</span></span>
<span id="cb14-11"><a href="#cb14-11" aria-hidden="true" tabindex="-1"></a>            }<span class="op">,</span></span>
<span id="cb14-12"><a href="#cb14-12" aria-hidden="true" tabindex="-1"></a>            <span class="dt">resize</span><span class="op">:</span> <span class="kw">function</span> (width<span class="op">,</span> height) {</span>
<span id="cb14-13"><a href="#cb14-13" aria-hidden="true" tabindex="-1"></a>                widget<span class="op">.</span><span class="fu">resize</span>(width<span class="op">,</span> height)</span>
<span id="cb14-14"><a href="#cb14-14" aria-hidden="true" tabindex="-1"></a>            }<span class="op">,</span></span>
<span id="cb14-15"><a href="#cb14-15" aria-hidden="true" tabindex="-1"></a>            <span class="dt">s</span><span class="op">:</span> widget</span>
<span id="cb14-16"><a href="#cb14-16" aria-hidden="true" tabindex="-1"></a>        }</span>
<span id="cb14-17"><a href="#cb14-17" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb14-18"><a href="#cb14-18" aria-hidden="true" tabindex="-1"></a>})</span></code></pre></div>
</div>
</div>
<div class="section level2">
<h2 id="trying-it-out">Trying it Out<a class="anchor" aria-label="anchor" href="#trying-it-out"></a>
</h2>
<p>Now the hard part is done, we need to bundle everything together and install the package:</p>
<div class="sourceCode" id="cb15"><pre class="sourceCode sh"><code class="sourceCode bash"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a><span class="ex">yarn</span> run build</span></code></pre></div>
<p>And then test out the widget in R:</p>
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va">detourr</span><span class="op">)</span>
<span class="fu"><a href="../reference/animate_tour.html">animate_tour</a></span><span class="op">(</span><span class="fu">tourr</span><span class="fu">::</span><span class="va"><a href="https://rdrr.io/pkg/tourr/man/Flea-measurements.html" class="external-link">flea</a></span>, <span class="fu"><a href="https://rdrr.io/pkg/tourr/man/grand_tour.html" class="external-link">grand_tour</a></span><span class="op">(</span><span class="fl">2</span><span class="op">)</span>, <span class="fu">display_hello_world</span><span class="op">(</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<p><img src="images/package_hello_world.png" width="100%"></p>
</div>
<div class="section level2">
<h2 id="some-useful-tips">Some Useful Tips<a class="anchor" aria-label="anchor" href="#some-useful-tips"></a>
</h2>
<p>Below are some useful tips to make things a little easier when developing widgets.</p>
<div class="section level3">
<h3 id="generating-sample_data-json">Generating <code>sample_data.json</code><a class="anchor" aria-label="anchor" href="#generating-sample_data-json"></a>
</h3>
<p>Rather than creating and modifying <code>sample_data.json</code> by hand for your development widget, it’s best to add some code to <code>scripts/generate_sample_data.R</code> to generate this file for you. For example:</p>
<p class="codeblock-label">
scripts/generate_sample_data.R
</p>
<div class="sourceCode" id="cb17"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">1</span><span class="op">)</span>

<span class="va">p</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/animate_tour.html">animate_tour</a></span><span class="op">(</span>
  <span class="fu">tourr</span><span class="fu">::</span><span class="va"><a href="https://rdrr.io/pkg/tourr/man/Flea-measurements.html" class="external-link">flea</a></span>,
  display <span class="op">=</span> <span class="fu">display_hello_world</span><span class="op">(</span><span class="op">)</span>,
  tour_path <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/tourr/man/grand_tour.html" class="external-link">grand_tour</a></span><span class="op">(</span><span class="fl">3</span><span class="op">)</span>
<span class="op">)</span>

<span class="fu"><a href="https://rdrr.io/r/base/writeLines.html" class="external-link">writeLines</a></span><span class="op">(</span>
  <span class="fu">jsonlite</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/jsonlite/man/fromJSON.html" class="external-link">toJSON</a></span><span class="op">(</span><span class="va">p</span><span class="op">$</span><span class="va">x</span>, auto_unbox <span class="op">=</span> <span class="cn">TRUE</span>, null <span class="op">=</span> <span class="st">"null"</span><span class="op">)</span>,
  <span class="st">"../dev/hello_world/static/sample_data.json"</span>
<span class="op">)</span></code></pre></div>
</div>
<div class="section level3">
<h3 id="using-the-browser-console">Using the Browser Console<a class="anchor" aria-label="anchor" href="#using-the-browser-console"></a>
</h3>
<p>If you’re not familiar with the development tools in Google Chrome and other browsers, it provides a good way to interact with the widget while it’s running. E.g. setting breakpoints and looking at what variables and objects are available in the TS code. In the <code>hello_world</code> example, we log the full data set that’s passed in from R to the console, which can help to give us some context when modifying the widget code:</p>
<p><img src="images/browser_console.png" width="100%"></p>
</div>
</div>
  </main><aside class="col-md-3"><nav id="toc"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p></p>
<p>Developed by Casper Hart, Earo Wang.</p>
</div>

<div class="pkgdown-footer-right">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.2.</p>
</div>

    </footer>
</div>

  

  

  </body>
</html>
